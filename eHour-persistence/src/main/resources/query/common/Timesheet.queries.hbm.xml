<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <query name="Timesheet.getEntriesBetweenDateForUserId">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.activity.assignedUser.userId = :userId
        ]]></query>

    <query name="Timesheet.getEntriesBetweenDateForActivity">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.activity = :activity
        ]]></query>

    <query name="Timesheet.getEntriesBetweenDate">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd
        ]]></query>

        
    <query name="Timesheet.getEntriesBeforeDateForActivity">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate < :date AND
                       entry.entryId.activity = :activity
        ]]></query>        

    <query name="Timesheet.getEntriesAfterDateForActivity">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate > :date AND
                       entry.entryId.activity = :activity
        ]]></query>        
        
    <query name="Timesheet.getBookedDaysInRangeForUserId">
        <![CDATA[SELECT new net.rrm.ehour.timesheet.dto.BookedDay(entry.entryId.entryDate, SUM(entry.hours))
        		 FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.activity.assignedUser.userId = :userId
				 GROUP BY entry.entryId.entryDate                       
        ]]></query>   

    <query name="TimesheetComment.getCommentsForUserIdInRange">
	    <![CDATA[
    	FROM TimesheetComment comment
    	WHERE comment.commentId.commentDate >= :dateStart AND
    		  comment.commentId.commentDate <= :dateEnd AND
    		  comment.commentId.userId = :userId
    		 ]]>
	</query>   

    <query name="Timesheet.getLatestEntryForActivityId">
    	FROM TimesheetEntry entry
    	WHERE entry.entryId.activity.id = :activityId
    	ORDER BY entry.updateDate DESC
	</query>   

    <query name="Timesheet.deleteOnActivityIds">
    <![CDATA[
    	DELETE
    	FROM TimesheetEntry entry
    	WHERE entry.entryId.activity.id IN (:activityIds)
    		 ]]>
	</query>  	
	
    <query name="TimesheetComment.deleteUserId">
    <![CDATA[
    	DELETE 
    	FROM TimesheetComment comment
    	WHERE comment.commentId.userId = :userId
    		 ]]>
	</query>  		
</hibernate-mapping>