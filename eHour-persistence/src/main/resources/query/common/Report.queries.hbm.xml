<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <query name="Report.getCumulatedHoursPerAssignmentOnDateForUsers">
         <![CDATA[SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
                FROM TimesheetEntry entry
                WHERE entry.entryId.entryDate >= :dateStart AND
                      entry.entryId.entryDate <= :dateEnd AND
                      entry.entryId.activity.assignedUser IN (:users)
                GROUP BY entry.entryId.activity.id
        ]]></query>

    <query name="Report.getCumulatedHoursPerAssignmentForUsers">
        SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
        FROM TimesheetEntry entry
        WHERE entry.entryId.activity.assignedUser IN (:users)
        GROUP BY entry.entryId.activity.id
	</query>

    <query name="Report.getCumulatedHoursPerAssignmentForAssignmentIds">
        SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
        FROM TimesheetEntry entry
        WHERE entry.entryId.activity.id IN (:assignmentIds)
        GROUP BY entry.entryId.activity.id
	</query>

    <query name="Report.getCumulatedHoursPerAssignmentForUsersAndProjects">
		SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
        FROM TimesheetEntry entry
        WHERE entry.entryId.activity.assignedUser IN (:users) AND
        	  entry.entryId.activity.project IN (:projects)
        GROUP BY entry.entryId.activity.id
	</query>

    <query name="Report.getCumulatedHoursPerAssignmentOnDateForUsersAndProjects">
         <![CDATA[SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
                FROM TimesheetEntry entry
                WHERE entry.entryId.entryDate >= :dateStart AND
                      entry.entryId.entryDate <= :dateEnd AND
                      entry.entryId.activity.assignedUser IN (:users) AND
                	  entry.entryId.activity.project IN (:projects)
                GROUP BY entry.entryId.activity.id
        ]]></query>
        
    <query name="Report.getCumulatedHoursPerAssignment">
        <![CDATA[
        SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
        FROM TimesheetEntry entry
        WHERE entry.entryId.entryDate >= :dateStart AND
              entry.entryId.entryDate <= :dateEnd 
        GROUP BY entry.entryId.activity.id
        ]]>
	</query>        
        
    <query name="Report.getCumulatedHoursPerAssignmentOnDateForProjects">
         <![CDATA[SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
                FROM TimesheetEntry entry
                WHERE entry.entryId.entryDate >= :dateStart AND
                      entry.entryId.entryDate <= :dateEnd AND
                	  entry.entryId.activity.project IN (:projects)
                GROUP BY entry.entryId.activity.id
        ]]>
	</query>
    
    <query name="Report.getCumulatedHoursForAssignment">
         <![CDATA[
         SELECT new net.rrm.ehour.report.reports.element.ActivityAggregateReportElement(entry.entryId.activity, SUM(entry.hours))
                FROM TimesheetEntry entry
                WHERE entry.entryId.activity = :assignment
                GROUP BY entry.entryId.activity.id                
        ]]>
	</query>

    <query name="Report.getMinMaxTimesheetEntryDate">
        SELECT new net.rrm.ehour.data.DateRange(min(entry.entryId.entryDate), max(entry.entryId.entryDate))
		FROM TimesheetEntry entry
	</query>     

    <query name="Report.getMinMaxTimesheetEntryDateForUser">
        SELECT new net.rrm.ehour.data.DateRange(min(entry.entryId.entryDate), max(entry.entryId.entryDate))
		FROM TimesheetEntry entry
        WHERE entry.entryId.activity.assignedUser = :user
	</query> 

    <query name="Report.getMinMaxTimesheetEntryDateForProject">
        SELECT new net.rrm.ehour.data.DateRange(min(entry.entryId.entryDate), max(entry.entryId.entryDate))
		FROM TimesheetEntry entry
        WHERE entry.entryId.projectAssignment.project = :project
	</query>

    <query name="Report.getActivitiesWithoutBookings">
        <![CDATA[FROM Activity act
        WHERE act NOT IN (SELECT entry.entryId.activity
                         FROM TimesheetEntry entry
                         WHERE entry.entryId.entryDate >= :dateStart AND
                               entry.entryId.entryDate <= :dateEnd)
              AND act.active is true AND
                  act.project.active is true AND
                  act.project.customer.active is true AND
                  (act.dateStart IS NULL OR act.dateStart < :dateEnd) AND
                  (act.dateEnd IS NULL or act.dateEnd > :dateStart)]]>
    </query>
</hibernate-mapping>